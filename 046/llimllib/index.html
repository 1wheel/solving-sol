<!--
## Wall Drawing #46 (1970)

Vertical lines, not straight, not touching, covering the wall evenly.
-->
<html><head>
<title>Sol LeWitt Wall Drawing #46</title>
<script>
function line(ctx, x1, y1, x2, y2) {
  ctx.beginPath();
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.stroke();
}


var ptable = {
  "4": [.01, .099, 0],
  "3": [.1, .088, .02],
  "2": [.25, .6, .15],
  "1": [.4, .4, .2],
  "0": [.5, .25, .25],
}

function lsr(ctx, originalx, curx) {
  // The probability of curx turning is 1/2**d, where d is the distance
  // from originalx
  var d = Math.round(Math.abs(originalx - curx));
  if (d > 4) { console.log("wtf", originalx, curx); }
  var p_straight = ptable[d.toString()][0],
      p_turnhome = ptable[d.toString()][1],
      p_turnaway = ptable[d.toString()][2];

  var r = Math.random();
  if (r < p_straight) {
    return curx;
  } else if (r > (1-p_turnaway)) {
    if (originalx == curx)     { return curx + (Math.random() < .5 ? -1 : 1); }
    else if (originalx > curx) { return curx-1; }
    else                       { return curx+1; }
  } else {
    if (originalx == curx)     { return curx + (Math.random() < .5 ? -1 : 1); }
    else if (originalx > curx) { return curx+1; }
    else                       { return curx-1; }
  }
}

// Uneven Vertical Line
function uvl(ctx, x, h) {
  ctx.beginPath();
  var y = 0;
  var originalx = x;
  ctx.moveTo(x, y);
  for (; y<h; y++) {
    x = lsr(ctx, originalx, x);
    ctx.lineTo(x, y);
  }
  ctx.stroke()
}

function draw(canvas, linespace, linew) {
  var ctx = canvas.getContext("2d"),
      h = canvas.height,
      w = canvas.width;

  console.log("drawing", linespace, linew)

  ctx.clearRect(0,0,w,h);

  for (var x=linespace; x < w; x+=linespace) {
    uvl(ctx, x, h);
  }
}

function clamp(n, min, max) {
  if (n > min) return Math.min(n, max);
  return Math.max(n, min);
}

document.addEventListener("DOMContentLoaded", function() {
  var canvas = document.getElementById("wall"),
      linespace = 8,
      linew = 1,
      mousemove = false,
      mousedown = undefined;

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    draw(canvas, linespace, linew);
  }

  window.addEventListener('resize', resizeCanvas);
  resizeCanvas(canvas);

  window.addEventListener("mousedown", function(evt) {
    mousemove = false;
    mousedown = evt;
  }, false);
  window.addEventListener("mousemove", function(evt) {
    if (mousedown !== undefined) {
      mousemove = true;
      diffX = evt.clientX - mousedown.clientX;
      diffY = evt.clientY - mousedown.clientY;

      temp_linespace = clamp(linespace - diffY/10, 2, 30);
      temp_linew = clamp(linew - diffX/10, 1, 10);
      draw(canvas, temp_linespace, temp_linew);
    }
  }, false);
  window.addEventListener("mouseup", function(evt) {
    if(mousemove) {
      linespace = temp_linespace;
      linew = temp_linew;
    }
    mousedown = undefined;
  }, false);

  window.addEventListener("keypress", function(evt) {
    // r for reset
    if (evt.keyCode == 114) {
      linew = 20;
      linespace = 20;
      draw(canvas, linespace, linew);
    }
  });

  var A = document.getElementById("A");
  var Q = document.getElementById("Q");
  A.style["visibility"] = "hidden";
  document.getElementById("Q").addEventListener("mouseover", function() {
    A.style["visibility"] = "";
    Q.style["visibility"] = "hidden";
  });
  document.getElementById("A").addEventListener("mouseout", function() {
    A.style["visibility"] = "hidden";
    Q.style["visibility"] = "";
  });
});
</script>
<style>
body { margin: 0; }
#Q { position: absolute; bottom: 5px; right: 5px; color: blue; background-color: white; font-size: 24px; }
#A { position: absolute; bottom: 5px; right: 5px; background-color: white; }
</style>
<html>
  <canvas id="wall"></canvas>
  <span id="Q">?</span>
  <pre id="A">Sol Lewitt Wall Drawing #130 (1972)

Grid and arcs from four corners.

Clicking and dragging in the X changes sets the grid width
Clicking and dragging in the Y changes sets the arc width
Pres "r" to reset
</pre>
</html>
