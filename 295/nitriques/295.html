<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>295 - nitriques</title>

	<link href="http://fonts.googleapis.com/css?family=Montserrat:400,700,800" rel="stylesheet" type="text/css" />
	<style>
html, body {
	margin: 0;
	padding: 0;
	width: 100%;
	height: 100%;
	overflow: hidden;
	font-family: 'Montserrat';
	color: #eee;
}
body.wall {
    background-color: black; // as stated
    font-size: 62.5%;
}

h1 {
	position: absolute;
	z-index: 10;
	margin: 0;
	top: 5px;
	left: 5px;
	font-size: 1.6rem;
}

#container {
	position: absolute;
	z-index: 1;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
}

svg {
	background-color: black; // as stated, again
	width: 100%;
	height: 100%;	
}

svg polygon {
	stroke-width: 2px;
	stroke: white; // as stated	
}

svg polygon {
	
}
	</style>
</head>
<body class="wall">
	<h1>Sol LeWitt's #295 - nitriques</h1>
    <div id="container"></div>
	
	<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.1/d3.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>
(function _295($, d3) {
	
	'use strict';
	
	/* CONST */
	
	var win = $(window);
	
	var size = {
		width: 0,
		height: 0,
		ratio: 1,
		shape: {
			width: 0,
			height: 0	
		}
	};
	
	var ctn = $('#container');
	
	var shapes = [];
	
	var NB_SHAPES = 6; // as stated
	var NB_PTS_MIN = 3;
	var NB_PTS_MAX = 8;
	var DEVIATION = 0.05; // in percent
	var PAD = 4; // could be negative to allow overlaps
	
	/* UTILS */
	
	var rnd = function (max, min) {
		// random "int"
		var i = ~~(Math.random() * 100000);
		if (!!max && !!min) {
			return (i % (max - min)) + min;
		} else if (!!max) {
			return i % max;	
		}
		return i;
	};
	
	var getter = function (value) {
		return function () { return value; };
	};
	
	/* DATA */
	
	var generatePolyPoints = function (sides, index) {
		var pts = [];
		var n = 0;
		var p;
		var w = size.shape.width;
		var h = size.shape.height;
		
		var angleSum = (sides - 1) * Math.PI;
		var angleMean = angleSum / sides;
		var angleDiff = angleMean * DEVIATION;
		var angle = 0;
		
		for (n; n < sides - 1; n++) {
			p = {
				x: 0,
				y: 0	
			};
			if (n === 0) {
				p.x = rnd((w * (index+1)) - PAD, (w * index) + PAD);
				p.y = rnd(h) + 100;
			} else {
				
				angle = rnd(angleMean + angleDiff, angleMean - angleDiff);
				p.x = pts[n-1].x + Math.cos(-angle) * 50;
				p.y = pts[n-1].y + Math.sin(-angle) * 50;
				
				// overflow x
				if (p.x < 0) {
					p.x = 0;
				} else if (p.x > size.width) {
					p.x = size.width;
				}
				// oveflow y
				if (p.y < 0) {
					p.y = 0;	
				} else if (p.y > size.height) {
					p.y = size.height;
				}
			}
			pts.push(p);	
		}
		return pts;
	};
	
	var createShape = function (index) {
		var sides = rnd(NB_PTS_MAX, NB_PTS_MIN);
		var points = generatePolyPoints(sides, index);
		
		return {
			sides: getter(sides),
			points: getter(points)
		};
	};
	
	var createShapes = function () {
		var n = 0;
		var shape;
		for (n; n < NB_SHAPES; n++) {
			shape = createShape(n);
			console.log('Creating a shape with %d sides', shape.sides());
			console.log('Points', shape.points());
			shapes.push(shape);
		}
	};
	
	/* RENDER */
	
	var draw = function () {
		var svg = d3.select(ctn[0])
			.append("svg")
				.attr("width", size.width)
				.attr("height", size.height);
		var vis = svg
			.append('g')
			.attr("transform", ''); // center it
		var polys = vis
			.selectAll('polygon');
			
		polys.data(shapes).enter()
			.append('polygon')
			.attr("points",function(d) { 
        return d.points().map(function(d) {
            return [d.x,d.y].join(",");
        }).join(" ");
    })
	};
	
	/* BOOTSTRAP */
	
	var updateSize = function () {
		size.width = win.width();
		size.height = win.height();
		size.ratio = !size.width || !size.height ? 1 : size.width / size.height;
		size.mean = (size.width + size.height) / 2;
		size.shape.width = size.width / NB_SHAPES;
		size.shape.height = size.height / 2;
		console.log('--> Size is %d x %d', size.width, size.height);
		console.log('--> Ratio %d', size.ratio);
		console.log('--> Mean %d', size.mean);
		console.log('--> Shape size is %d x %d', size.shape.width, size.shape.height);
	};
	
	var resize = function () {
		updateSize();
		// ...
	};
	
	var init = function () {
		win.resize(resize);
		updateSize();
		createShapes();
		draw();
	};
	
	$(init);
		
})(window.jQuery, window.d3);
	</script>
</body>
</html>